---
title: "Primary Care Provider Leaflet"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Leaflet Map

```{r load-libraries}

# load libraries
library(leaflet)
library(tidyverse)
library(htmlwidgets)
library(fontawesome)
#library(icons)
```


```{r data import, echo = FALSE}

# read csv
pcp_df <- read_csv("data/primary care providers/maine_primary_care.csv")

```


```{r primary-care-provider-leaflet}

maine_icons <- awesomeIconList(
  `Doctor` = makeAwesomeIcon(
  icon = "user-md",
  library = "fa",
  markerColor = "lightred"
),
  `Family practice physician` = makeAwesomeIcon(
  icon = "users",
  library = "fa",
  markerColor = "green"
),
  `Medical clinic` = makeAwesomeIcon(
  icon = "plus-square",
  library = "fa",
  markerColor = "beige"
),
  `Medical office` = makeAwesomeIcon(
  icon = "plus-square",
  library = "fa",
  markerColor = "blue"
),
  `Medical group` = makeAwesomeIcon(
  icon = "plus-square",
  library = "fa",
  markerColor = "purple"
),
  `Internist`  = makeAwesomeIcon(
  icon = "user-md",
  library = "fa",
  markerColor = "orange"
),
  `Medical Center` = makeAwesomeIcon(
  icon = "plus-square",
  library = "fa",
  markerColor = "lightred"
),
  `Reproductive health clinic` = makeAwesomeIcon(
  icon = "heart",
  library = "fa",
  markerColor = "pink"
),
  `Home health care service` = makeAwesomeIcon(
  icon = "home",
  library = "fa",
  markerColor = "yellow"
),
  `General practitioner` = makeAwesomeIcon(
  icon = "user-md",
  library = "fa",
  markerColor = "beige"
),
  `Hospital` = makeAwesomeIcon(
  icon = "h-square",
  library = "fa",
  markerColor = "orange"
),
  `Emergency care physician` = makeAwesomeIcon(
  icon = "medkit",
  library = "fa",
  markerColor = "purple"
),
  `Podiatrist` = makeAwesomeIcon(
  icon =  "user-md",
  library = "fa",
  markerColor = "teal"
),
  `Children's hospital` = makeAwesomeIcon(
  icon =  "h-square",
  library = "fa",
  markerColor = "white"
)
)

# make popup text with name, address, notes, and link to website
pcp_df <-
  pcp_df %>% 
  mutate(full_website = paste("<b><a href='https://www.", website,"' target='_blank'>", title,"</a></b>", "<br/>", sep = "")) 

# make popup text with name, address, notes, and link to website
pcp_labels <- sprintf(
  "<strong>%s</strong><br/>%s<br/><strong>Rating: %g of 5</strong>",
  pcp_df$full_website, pcp_df$address, pcp_df$rating
) %>% lapply(htmltools::HTML)


# setup basemap
pcp_leaflet <- 
  leaflet() %>% 
  addTiles() %>%
  addMarkers(~pcp_df$longitude, 
             ~pcp_df$latitude, 
             data = pcp_df, 
             group = pcp_df$category, 
             popup = ~pcp_labels)
  

pcp_leaflet <- 
      leaflet(data = pcp_df) %>%
      addTiles() %>% addAwesomeMarkers(
      ~longitude,
      ~latitude,
      popup = ~pcp_labels,
      icon = ~maine_icons[category], 
      group = ~category)

# add layer controls to map 
pcp_leaflet <- 
  pcp_leaflet %>% 
  addLayersControl(
    overlayGroups = pcp_df$category,
    options = layersControlOptions(collapsed = FALSE)
  )

# save widget 
saveWidget(pcp_leaflet, "maine_pcp.html")

```


