---
title: "Population and Age of Maine Cities"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages

```{r libraries, echo = FALSE}

library(tidyverse) 
library(leaflet) 
library(sf) 
library(RColorBrewer) 
library(htmltools) 
library(leafsync) 
library(kableExtra) 

```

# Import and Clean Data

```{r data-import, echo = FALSE}

# read shape files
me_cities <- st_read("data/demographics/spatial/cities/tl_2016_23_place.shp")
me_counties <- st_read("data/demographics/spatial/counties/Maine_County_Boundary_Polygons_Feature.shp")

# read csv file
me_pop <- read_csv("data/demographics/maine_city_population.csv")


# merge data
me_pop %>% rename(NAME = name)

me_spatial <- me_spatial %>%
  merge(me_spatial, me_pop, by="NAME")


  


```

```{r change-coordinate-reference-system, echo = FALSE}

# change CRS
me_cities <- st_transform(me_cities, "+init=epsg:4326")
me_counties <- st_transform(me_counties, "+init=epsg:4326")

# report new CRS
st_crs(me_cities)
st_crs(me_counties)
```

# Generate Cities Leaflet

```{r generate-cities-leaflet-basemap, echo = FALSE}

# set view and add texture
me_cities_bm <- leaflet(data = me_cities) %>% #<<
  addProviderTiles(providers$Stamen.Terrain) %>%
  setView(lng = -69.5, 
          lat = 45.3, 
          zoom = 6.5)

# add city borders
me_cities_bm %>%
  addPolygons(
    opacity = 1,
    color = "blue", 
    weight = 2) 
```

```{r generate-cities-leaflet-labels, echo = FALSE}

# create labels
me_cities_labels <- sprintf("<strong>%s</strong><br/>geoid # %s ", 
                  me_cities$NAME, me_cities$GEOID) %>% lapply(htmltools::HTML)

```


```{r first-cities-leaflet-map, eval=TRUE}
me_cities_map <- me_cities_bm %>%
  addPolygons(
      color = "blue", 
      opacity = 1,
      weight = 2,
    highlight = highlightOptions( #<<
        weight = 3, #<<
        color = "green", #<<
        fillOpacity = 1, #<<
        bringToFront = TRUE)) #<< 

me_cities_map
```

 
# Generate Counties Leaflet

```{r generate-counties-leaflet-basemap, echo = FALSE}

# set view and add texture
me_counties_bm <- leaflet(data = me_counties) %>% #<<
  addProviderTiles(providers$Stamen.Terrain) %>%
  setView(lng = -69.5, 
          lat = 45.3, 
          zoom = 6.5)

# add city borders
me_counties_bm %>%
  addPolygons(
    opacity = 1,
    color = "blue", 
    weight = 2) 
```

```{r generate-counties-leaflet-labels, echo = FALSE}

# create labels
me_counties_labels <- sprintf("<strong>%s</strong><br/>objectid # %s ", 
                  me_counties$NAME, me_counties$OBJECTID) %>% lapply(htmltools::HTML)

```


```{r first-counties-leaflet-map, eval=TRUE}
me_counties_map <- me_counties_bm %>%
  addPolygons(
      color = "blue", 
      opacity = 1,
      weight = 2,
    highlight = highlightOptions( #<<
        weight = 3, #<<
        color = "green", #<<
        fillOpacity = 1, #<<
        bringToFront = TRUE)) #<< 

me_counties_map